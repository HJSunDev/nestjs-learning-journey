---
alwaysApply: true
---

# 经验沉淀体系 (Experience Accumulation System)

在 AI 协作中，踩坑经验和试错结论必须被持久化保留，避免重复犯错。本规则定义经验的读取与沉淀协议。

## 1. 行为协议

### 1.1 行动前阅读 (Read-Before-Act)

**触发条件**: 即将**修改**某模块代码时（纯阅读或问答不触发）。

**执行步骤**:
1. 识别目标模块（通常对应 `src/` 下的功能目录名）。
2. 读取 `.cursor/experience/modules/{模块名}.md`（如存在）。
3. 检查 `.cursor/experience/global/` 下相关文件（如存在）。
4. 将已读取的经验纳入本次决策上下文，避免重蹈覆辙。

> 此步骤静默执行，无需向用户报告，除非经验内容直接影响了方案选择。

### 1.2 解决问题后沉淀 (Post-Resolution Capture)

**触发条件**: 协作中解决了**非平凡问题**（反复试错、配置陷阱、框架隐式行为、版本兼容性等）。

**执行步骤**:
1. 判断经验是否值得沉淀（参照第 3 节判断标准）。
2. 向用户简要说明建议沉淀的要点，询问是否记录。
3. **等待用户明确确认后**才写入，严禁自动写入。
4. 按模板追加至对应文件末尾，并同步更新 `_index.md`。

## 2. 目录结构与命名

```
.cursor/experience/
├── _index.md              # 经验总索引
├── modules/               # 模块级经验（映射项目功能模块）
│   └── {module-name}.md
└── global/                # 全局 / 跨模块经验
    └── {topic}.md
```

- **modules/**: 文件名与项目源码中的功能模块目录名保持一致（如 `auth.md`, `ai.md`）。嵌套模块用连字符连接（如 `common/redis/` → `common-redis.md`）。
- **global/**: 按主题自由命名，使用 kebab-case（如 `database.md`, `docker.md`, `typescript-pitfalls.md`）。
- 文件不存在时，在用户确认沉淀后按需创建。

## 3. 判断标准

**应沉淀**:
- 文档未明确说明的配置陷阱或隐式行为
- 反复试错后才定位的正确方案
- 框架 / 库的边界条件或版本兼容问题
- 跨模块交互的注意事项
- 性能相关的关键发现

**不应沉淀**:
- 官方文档已清晰说明的标准用法
- 简单的拼写错误或语法 bug
- 纯业务逻辑决策（属于产品需求而非技术经验）

## 4. 条目模板

每条经验追加到对应文件末尾，格式如下：

```markdown
---

### [EXP-{序号}] {问题简述}

- **日期**: YYYY-MM-DD
- **关联**: `{涉及的关键文件或功能}`
- **标签**: `#{tag1}` `#{tag2}`

#### 问题现象
{遇到了什么问题？表现是什么？}

#### 根因分析
{为什么出现？底层原因是什么？}

#### 验证方案 ✅
{最终有效的解决方案，包含关键代码片段（如需要）}

#### 反模式 ❌
{尝试过但无效的方案，以及失败原因}

#### 适用条件
{此经验适用的前提条件，如框架版本、特定配置等}
```

## 5. 维护规则

- 新增条目后，必须同步更新 `.cursor/experience/_index.md`。
- 序号在每个文件内独立自增（EXP-001, EXP-002...）。
- 过时的经验添加 `[DEPRECATED]` 前缀及原因说明，不得静默删除。
- 条目应简洁精炼，聚焦关键信息，避免冗长叙述。
